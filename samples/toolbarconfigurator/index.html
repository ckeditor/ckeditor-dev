<!DOCTYPE html>
<!--
Copyright (c) 2003-2015, CKSource - Frederico Knabben. All rights reserved.
For licensing, see LICENSE.md or http://ckeditor.com/license
-->
<html>
<head>
	<meta charset="utf-8">
	<title>Toolbar Configurator</title>
	<script src="../../ckeditor.js"></script>
	<script>
		if ( CKEDITOR.env.ie && CKEDITOR.env.version < 9 )
			CKEDITOR.tools.enableHtml5Elements( document );
	</script>
	<link rel="stylesheet" href="lib/codemirror/codemirror.css">
	<link rel="stylesheet" href="lib/codemirror/show-hint.css">
	<link rel="stylesheet" href="lib/codemirror/neo.css">
	<link rel="stylesheet" href="css/fontello.css">
	<link rel="stylesheet" href="css/toolbarmodifier.css">
	<link rel="stylesheet" href="../css/sample.css">
</head>
<body>

<header>
	<div>
		<h1>
			<a href="index.html"><img src="../img/logo.png" alt="CKEditor Sample"></a>
		</h1>
		<nav class="navigation main-navigation">
			<ul>
				<li><a href="../index.html">Start</a></li>
				<li><a href="index.html" class="active">Toolbar configurator</a></li>
			</ul>
		</nav>
	</div>
	<nav class="navigation top-navigation">
		<div>
			<ul>
				<li><a href="http://ckeditor.com">Project Homepage</a></li>
				<li><a href="http://dev.ckeditor.com/">I found a bug</a></li>
				<li><a href="http://github.com/ckeditor/ckeditor-dev" class="fork">Fork CKEditor on GitHub</a></li>
			</ul>
			<ul class="right">
				<li><a href="http://ckeditor.com/blog-list">CKEditor Blog</a></li>
			</ul>
		</div>
	</nav>
</header>

<main>
	<section class="adjoined">
		<div>
			<h1>Toolbar configurator</h1>
			<span class="mode-switch">
				<span id="mode-switch-basic" class="fancy-button fancy-button-red fancy-button-active">Basic</span>
				<span id="mode-switch-advanced" class="fancy-button fancy-button-red">Advanced</span>
				<span class="fancy-tip">Select configurator type</span>
			</span>
			<div class="editors-container">
				<div id="editor-basic"></div>
				<div id="editor-advanced"></div>
			</div>
		</div>
	</section>
	<section class="configurator">
		<div class="instructions-container">
			<div class="basic" style="display: none;">
				<p>Arrange <a href="http://docs.ckeditor.com/#!/api/CKEDITOR.config-cfg-toolbarGroups">toolbar groups</a> and toggle <a href="http://docs.ckeditor.com/#!/api/CKEDITOR.config-cfg-removeButtons">buttons visibility</a> according to your needs and get your toolbar configuration.</p>
				<p>You can replace <a href="../../config.js"><code>config.js</code></a> file contents with the generated configuration. If you already set some configuration options you will need to merge both configurations.</p>
				<p>Read more about different ways of <a href="http://docs.ckeditor.com/#!/guide/dev_configuration">setting configuration</a> and do not forget about <strong>clearing browser cache</strong>.</p>
				<p>Arranging toolbar groups is the recommended way of configuring toolbar, but if you need more freedom you can use the <a href="#advanced">advanced configurator</a>.</p>
			</div>
			<div class="advanced" style="display: none;">
				<p>With this code editor you can edit live your <a href="http://docs.ckeditor.com/#!/api/CKEDITOR.config-cfg-toolbar">toolbar configuration</a>.</p>
				<p>You can replace <a href="../../config.js"><code>config.js</code></a> file contents with the generated configuration. If you already set some configuration options you will need to merge both configurations.</p>
				<p>Read more about different ways of <a href="http://docs.ckeditor.com/#!/guide/dev_configuration">setting configuration</a> and do not forget about <strong>clearing browser cache</strong>.</p>
			</div>
		</div>
		<div>
			<div id="toolbarModifierWrapper"></div>
		</div>
	</section>

	<script src="lib/codemirror/codemirror.js"></script>
	<script src="lib/codemirror/javascript.js"></script>
	<script src="lib/codemirror/show-hint.js"></script>

	<script src="js/fulltoolbareditor.js"></script>
	<script src="js/abstracttoolbarmodifier.js"></script>
	<script src="js/toolbarmodifier.js"></script>
	<script src="js/toolbartextmodifier.js"></script>

	<script>
		( function() {
			var mode = ( window.location.hash.substr( 1 ) === 'advanced' ) ? 'advanced' : 'basic',
				resetConfig = {
					removeButtons: '',
					toolbarGroups: null,
					toolbar: null
				},
				configuratorSection = CKEDITOR.document.findOne( 'section.configurator' ),
				basicInstruction = CKEDITOR.document.findOne( '.instructions-container > .basic' ),
				advancedInstruction = CKEDITOR.document.findOne( '.instructions-container > .advanced' );

			CKEDITOR.document.getWindow().on( 'resize', function() {
				updateToolbar( ( mode === 'basic' ? toolbarModifier : toolbarTextModifier )[ 'editorInstance' ] );
			} );

			// Basic, configurator.
			CKEDITOR.replace( 'editor-basic', resetConfig );

			function onRefresh( modifier ) {
				modifier = modifier || this;

				if ( mode === 'basic' && modifier instanceof ToolbarConfigurator.ToolbarTextModifier ) {
					return;
				}

				// CodeMirror container becomes visible, so we need to refresh and to avoid rendering problems.
				if ( mode === 'advanced' && modifier instanceof ToolbarConfigurator.ToolbarTextModifier ) {
					modifier.codeContainer.refresh();
				}

				updateToolbar( modifier.editorInstance );
			}

			function updateToolbar( editor ) {
				var editorContainer = editor.container,
					displayStyle = editorContainer.getStyle( 'display' );

				editorContainer.setStyle( 'display', 'block' );

				var newHeight = parseInt( editorContainer.getComputedStyle( 'height' ), 10 );
				newHeight = ( isNaN( newHeight ) ? 0 : Number( newHeight ) );

				var newMarginTop = parseInt( editorContainer.getComputedStyle( 'margin-top' ), 10 );
				newMarginTop = ( isNaN( newMarginTop ) ? 0 : Number( newMarginTop ) );

				var newMarginBottom = parseInt( editorContainer.getComputedStyle( 'margin-bottom' ), 10 );
				newMarginBottom = ( isNaN( newMarginBottom ) ? 0 : Number( newMarginBottom ) );

				var result = newHeight + newMarginTop + newMarginBottom;

				editorContainer.setStyle( 'display', displayStyle );

				editor.container.getAscendant( 'div' ).setStyle( 'height', result + 'px' );
			}

			var toolbarModifier = new ToolbarConfigurator.ToolbarModifier( 'editor-basic' );

			var done = 0;
			toolbarModifier.init( onToolbarInit );
			toolbarModifier.onRefresh = onRefresh;

			CKEDITOR.document.getById( 'toolbarModifierWrapper' ).append( toolbarModifier.mainContainer );

			// Advanced configurator.
			CKEDITOR.replace( 'editor-advanced', resetConfig );

			var toolbarTextModifier = new ToolbarConfigurator.ToolbarTextModifier( 'editor-advanced' );
			toolbarTextModifier.init( onToolbarInit );
			toolbarTextModifier.onRefresh = onRefresh;

			function onToolbarInit() {
				if ( ++done === 2 ) {
					onToolbarsDone();
				}
			}

			function onToolbarsDone() {
				if ( mode === 'basic' ) {
					toggleModeBasic( false );
				} else {
					toggleModeAdvanced( false );
				}

				setTimeout( function() {
					CKEDITOR.document.findOne( '.editors-container' ).addClass( 'active' );
				}, 200 );
			}

			CKEDITOR.document.getById( 'toolbarModifierWrapper' ).append( toolbarTextModifier.mainContainer );

			// Configurator mode switcher.
			var modeSwitchBasic = CKEDITOR.document.getById( 'mode-switch-basic' ),
				modeSwitchAdvanced = CKEDITOR.document.getById( 'mode-switch-advanced' );

			function toogleModeSwitch( onElement, offElement, onModifier, offModifier ) {
				onElement.addClass( 'fancy-button-active' );
				offElement.removeClass( 'fancy-button-active' );

				onModifier.showUI();
				offModifier.hideUI();
			}

			function toggleModeBasic( callOnRefresh ) {
				callOnRefresh = ( callOnRefresh !== false );
				mode = 'basic';
				window.location.hash = '#basic';
				toogleModeSwitch( modeSwitchBasic, modeSwitchAdvanced, toolbarModifier, toolbarTextModifier );

				configuratorSection.removeClass( 'width-freed' );
				basicInstruction.show();
				advancedInstruction.hide();

				callOnRefresh && onRefresh( toolbarModifier );
			}

			function toggleModeAdvanced( callOnRefresh ) {
				callOnRefresh = ( callOnRefresh !== false );
				mode = 'advanced';
				window.location.hash = '#advanced';
				toogleModeSwitch( modeSwitchAdvanced, modeSwitchBasic, toolbarTextModifier, toolbarModifier );

				configuratorSection.addClass( 'width-freed' );
				advancedInstruction.show();
				basicInstruction.hide();

				callOnRefresh && onRefresh( toolbarTextModifier );
			}

			modeSwitchBasic.on( 'click', toggleModeBasic );
			modeSwitchAdvanced.on( 'click', toggleModeAdvanced );
		} )();
	</script>
</main>

<footer>
	<div>
		<p>
			CKEditor - The text editor for the Internet - <a class="samples" href="http://ckeditor.com/">http://ckeditor.com</a>
		</p>
		<p id="copy">
			Copyright &copy; 2003-2015, <a class="samples" href="http://cksource.com/">CKSource</a> - Frederico Knabben. All rights reserved.
		</p>
	</div>
</footer>

</body>
</html>
